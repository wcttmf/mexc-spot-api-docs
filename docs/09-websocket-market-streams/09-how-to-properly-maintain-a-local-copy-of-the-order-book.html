<h2 id="how-to-properly-maintain-a-local-copy-of-the-order-book">How to Properly Maintain a Local Copy of the Order Book</h2>
<ol>
<li>Connect to the WebSocket and subscribe to <code>spot@public.aggre.depth.v3.api.pb@(100ms|10ms)@MXBTC</code> to obtain incremental aggregated depth information.<br/></li>
<li>Access the REST API <code>https://api.mexc.com/api/v3/depth?symbol=MXBTC&amp;limit=1000</code> to obtain a depth snapshot with 1000 levels.<br/></li>
<li>The <code>fromVersion</code> of each new push message should be exactly equal to the <code>toVersion + 1</code> of the previous message. Otherwise, packet loss has occurred, and reinitialization from step 2 is required.<br/></li>
<li>The order quantity in each push message represents the absolute value of the current order quantity at that price level, not a relative change.<br/></li>
<li>If the <code>toVersion</code> in the push message is smaller than the <code>version</code> in the snapshot, the message is outdated and should be ignored.<br/></li>
<li>If the <code>fromVersion</code> in the push message is greater than the <code>version</code> in the snapshot, data is missing between the push message and the snapshot, requiring reinitialization from step 2.<br/></li>
<li>Now that the <code>version</code> in the snapshot falls within the <code>[fromVersion, toVersion]</code> range of the push message, the push message can be integrated with the snapshot data as follows:<br/>
<ul>
<li>If the price level in the push message already exists in the snapshot, update the quantity based on the push message.<br/></li>
<li>If the price level in the push message does not exist in the snapshot, insert a new entry with the quantity from the push message.<br/></li>
<li>If a price level in the push message has a quantity of 0, remove that price level from the snapshot.<br/></li>
</ul></li>
</ol>
<p><strong>Note:</strong> Since the depth snapshot has a limitation on the number of price levels, price levels outside the initial snapshot that have not changed in quantity will not appear in incremental push messages. Therefore, the local order book may differ slightly from the real order book. However, for most use cases, the 5000-depth limit is sufficient to effectively understand the market and trading activity.</p>
<hr/>
<h1 id="websocket-user-data-streams">Websocket User Data Streams</h1>
<ul>
<li>The base API endpoint is: <strong>https://api.mexc.com</strong></li>
<li>A User Data Stream <code>listenKey</code> is valid for 60 minutes after creation.</li>
<li>Doing a <code>PUT</code> on a  <code>listenKey</code> will extend its validity for 60 minutes.</li>
<li>Doing a <code>DELETE</code> on a <code>listenKey</code> will close the stream and invalidate the <code>listenKey</code>.</li>
<li>websocket baseurl: <strong>ws://wbs-api.mexc.com/ws</strong></li>
<li>User Data Streams are accessed at  <strong>/ws?listenKey=listenKey</strong><br/>
For example: <strong>ws://wbs-api.mexc.com/ws?listenKey=pqia91ma19a5s61cv6a81va65sd099v8a65a1a5s61cv6a81va65sdf19v8a65a1</strong></li>
<li>A single connection is only valid for 24 hours; expect to be disconnected at the 24 hour mark.</li>
<li>Each UID can apply for a maximum of 60 listen keys (excluding invalid listen keys).</li>
<li>Each listen key maximum support 5 websocket connection (which means each uid can applies for a maximum of 60 listen keys and 300 ws links).</li>
</ul>
